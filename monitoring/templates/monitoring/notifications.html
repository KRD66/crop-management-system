{% extends 'monitoring/base.html' %}

{% block title %}Notifications - HarvestPro{% endblock %}

{% block extra_css %}
<style>
    /* Notification Statistics Cards */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        display: flex;
        align-items: center;
        gap: 15px;
        border-left: 4px solid #3b82f6;
    }

    .stat-card:nth-child(2) { border-left-color: #f59e0b; }
    .stat-card:nth-child(3) { border-left-color: #ef4444; }
    .stat-card:nth-child(4) { border-left-color: #8b5cf6; }

    .stat-icon {
        width: 50px;
        height: 50px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
        flex-shrink: 0;
    }

    .stat-card:nth-child(1) .stat-icon { background: #3b82f6; }
    .stat-card:nth-child(2) .stat-icon { background: #f59e0b; }
    .stat-card:nth-child(3) .stat-icon { background: #ef4444; }
    .stat-card:nth-child(4) .stat-icon { background: #8b5cf6; }

    .stat-content { flex: 1; }
    .stat-value { font-size: 2rem; font-weight: bold; color: #1f2937; margin: 5px 0; line-height: 1; }
    .stat-label { color: #6b7280; font-size: 0.9rem; font-weight: 500; }

    /* Main Content Area */
    .content-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
    }

    .section {
        background: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #e5e7eb;
    }

    .section-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: #1f2937;
        margin: 0;
    }

    .section-subtitle {
        color: #6b7280;
        font-size: 0.9rem;
        margin: 5px 0 0 0;
    }

    .action-buttons {
        display: flex;
        gap: 10px;
    }

    .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 500;
        transition: all 0.2s;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }

    .btn-primary {
        background: #3b82f6;
        color: white;
    }
    .btn-primary:hover { background: #2563eb; }

    .btn-secondary {
        background: #6b7280;
        color: white;
    }
    .btn-secondary:hover { background: #4b5563; }

    /* Notification Items */
    .notification-item {
        padding: 15px;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        margin-bottom: 12px;
        display: flex;
        align-items: flex-start;
        gap: 15px;
        transition: all 0.2s;
        position: relative;
    }

    .notification-item:hover {
        background: #f9fafb;
        border-color: #d1d5db;
    }

    .notification-icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.1rem;
        color: white;
        flex-shrink: 0;
    }

    .notification-content {
        flex: 1;
        min-width: 0;
    }

    .notification-title {
        font-weight: 600;
        color: #1f2937;
        margin: 0 0 5px 0;
        font-size: 1rem;
    }

    .notification-message {
        color: #6b7280;
        margin: 0 0 8px 0;
        font-size: 0.9rem;
        line-height: 1.4;
    }

    .notification-meta {
        display: flex;
        align-items: center;
        gap: 15px;
        font-size: 0.8rem;
        color: #9ca3af;
    }

    .notification-actions {
        display: flex;
        flex-direction: column;
        gap: 8px;
        align-items: flex-end;
    }

    .priority-badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
    }

    .priority-high {
        background: #fee2e2;
        color: #dc2626;
    }

    .priority-medium {
        background: #fef3c7;
        color: #d97706;
    }

    .priority-low {
        background: #dbeafe;
        color: #2563eb;
    }

    .btn-small {
        padding: 4px 8px;
        font-size: 0.8rem;
        border-radius: 4px;
    }

    /* Notification Types */
    .notification-item[data-type="harvest"] .notification-icon {
        background: #3b82f6;
    }

    .notification-item[data-type="weather"] .notification-icon {
        background: #f59e0b;
    }

    .notification-item[data-type="inventory"] .notification-icon {
        background: #ef4444;
    }

    .notification-item[data-type="completed"] .notification-icon {
        background: #10b981;
    }

    .notification-item[data-type="expiry"] .notification-icon {
        background: #8b5cf6;
    }

    /* Settings Panel */
    .settings-section {
        margin-bottom: 25px;
    }

    .settings-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: #1f2937;
        margin: 0 0 15px 0;
    }

    .setting-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid #f3f4f6;
    }

    .setting-item:last-child {
        border-bottom: none;
    }

    .setting-label {
        color: #374151;
        font-weight: 500;
    }

    /* Toggle Switch */
    .toggle {
        position: relative;
        width: 50px;
        height: 24px;
        background: #d1d5db;
        border-radius: 12px;
        cursor: pointer;
        transition: background 0.3s;
    }

    .toggle.active {
        background: #10b981;
    }

    .toggle::before {
        content: '';
        position: absolute;
        top: 2px;
        left: 2px;
        width: 20px;
        height: 20px;
        background: white;
        border-radius: 50%;
        transition: transform 0.3s;
    }

    .toggle.active::before {
        transform: translateX(26px);
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #6b7280;
    }

    .empty-state i {
        font-size: 3rem;
        margin-bottom: 15px;
        opacity: 0.5;
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .content-grid {
            grid-template-columns: 1fr;
            gap: 20px;
        }
    }

    @media (max-width: 768px) {
        .stats-grid { 
            grid-template-columns: 1fr; 
            gap: 12px; 
        }
        
        .stat-card { 
            padding: 1rem; 
            gap: 12px; 
        }
        
        .stat-value { 
            font-size: 1.5rem; 
        }
        
        .section { 
            padding: 15px; 
            margin-bottom: 15px; 
        }
        
        .notification-item {
            padding: 12px;
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }
        
        .notification-actions {
            flex-direction: row;
            align-items: center;
            align-self: stretch;
            justify-content: flex-end;
        }
    }

    @media (max-width: 480px) {
        .action-buttons {
            flex-direction: column;
        }
        
        .notification-meta {
            flex-direction: column;
            align-items: flex-start;
            gap: 5px;
        }
    }
</style>
{% endblock %}

{% block header_content %}
<h1>Notifications</h1>
<p>Important farm activities</p>
{% endblock %}

{% block content %}
<!-- Statistics Cards -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-bell"></i>
        </div>
        <div class="stat-content">
            <div class="stat-value">5</div>
            <div class="stat-label">All notifications</div>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="stat-content">
            <div class="stat-value">3</div>
            <div class="stat-label">Need attention</div>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-fire"></i>
        </div>
        <div class="stat-content">
            <div class="stat-value">2</div>
            <div class="stat-label">Urgent items</div>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-cog"></i>
        </div>
        <div class="stat-content">
            <div class="stat-value">5</div>
            <div class="stat-label">Notification types</div>
        </div>
    </div>
</div>

<!-- Main Content Grid -->
<div class="content-grid">
    <!-- Recent Notifications -->
    <div class="section">
        <div class="section-header">
            <div>
                <h2 class="section-title">Recent Notifications</h2>
                <p class="section-subtitle">Stay updated with important farm activities</p>
            </div>
            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="showUnread()">Show Unread</button>
                <button class="btn btn-primary" onclick="markAllRead()">Mark All Read</button>
            </div>
        </div>

        <div class="notifications-list">
            <!-- Harvest Due Alert -->
            <div class="notification-item" data-type="harvest">
                <div class="notification-icon">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <div class="notification-content">
                    <h3 class="notification-title">Harvest Due Alert</h3>
                    <p class="notification-message">Corn harvest is due in 3 days at North Field</p>
                    <div class="notification-meta">
                        <span><i class="far fa-clock"></i> 2024-08-08 09:30</span>
                        <span><i class="fas fa-map-marker-alt"></i> odo-eja Field</span>
                    </div>
                </div>
                <div class="notification-actions">
                    <span class="priority-badge priority-high">high</span>
                    <div>
                        <button class="btn btn-primary btn-small" onclick="markAsRead(this)">Mark Read</button>
                        <button class="btn btn-secondary btn-small" onclick="deleteNotification(this)">Delete</button>
                    </div>
                </div>
            </div>

            <!-- Weather Warning -->
            <div class="notification-item" data-type="weather">
                <div class="notification-icon">
                    <i class="fas fa-cloud-rain"></i>
                </div>
                <div class="notification-content">
                    <h3 class="notification-title">Weather Warning</h3>
                    <p class="notification-message">Heavy rain expected tomorrow. Consider postponing harvest.</p>
                    <div class="notification-meta">
                        <span><i class="far fa-clock"></i> 2024-08-08 08:15</span>
                        <span><i class="fas fa-map-marker-alt"></i> All Farms</span>
                    </div>
                </div>
                <div class="notification-actions">
                    <span class="priority-badge priority-medium">medium</span>
                    <div>
                        <button class="btn btn-primary btn-small" onclick="markAsRead(this)">Mark Read</button>
                        <button class="btn btn-secondary btn-small" onclick="deleteNotification(this)">Delete</button>
                    </div>
                </div>
            </div>

            <!-- Low Inventory Alert -->
            <div class="notification-item" data-type="inventory">
                <div class="notification-icon">
                    <i class="fas fa-box"></i>
                </div>
                <div class="notification-content">
                    <h3 class="notification-title">Low Inventory Alert</h3>
                    <p class="notification-message">Soybeans inventory below 500 tons threshold</p>
                    <div class="notification-meta">
                        <span><i class="far fa-clock"></i> 2024-08-07 16:45</span>
                        <span><i class="fas fa-map-marker-alt"></i> Warehouse A</span>
                    </div>
                </div>
                <div class="notification-actions">
                    <span class="priority-badge priority-medium">medium</span>
                    <div>
                        <button class="btn btn-secondary btn-small" onclick="deleteNotification(this)">Delete</button>
                    </div>
                </div>
            </div>

            <!-- Harvest Completed -->
            <div class="notification-item" data-type="completed">
                <div class="notification-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="notification-content">
                    <h3 class="notification-title">Harvest Completed</h3>
                    <p class="notification-message">Wheat harvest completed successfully at South Field</p>
                    <div class="notification-meta">
                        <span><i class="far fa-clock"></i> 2024-08-07 14:20</span>
                        <span><i class="fas fa-map-marker-alt"></i> South Field</span>
                    </div>
                </div>
                <div class="notification-actions">
                    <span class="priority-badge priority-low">low</span>
                    <div>
                        <button class="btn btn-secondary btn-small" onclick="deleteNotification(this)">Delete</button>
                    </div>
                </div>
            </div>

            <!-- Stock Expiry Warning -->
            <div class="notification-item" data-type="expiry">
                <div class="notification-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="notification-content">
                    <h3 class="notification-title">Stock Expiry Warning</h3>
                    <p class="notification-message">Rice inventory expires in 30 days</p>
                    <div class="notification-meta">
                        <span><i class="far fa-clock"></i> 2024-08-07 10:30</span>
                        <span><i class="fas fa-map-marker-alt"></i> Warehouse C</span>
                    </div>
                </div>
                <div class="notification-actions">
                    <span class="priority-badge priority-high">high</span>
                    <div>
                        <button class="btn btn-primary btn-small" onclick="markAsRead(this)">Mark Read</button>
                        <button class="btn btn-secondary btn-small" onclick="deleteNotification(this)">Delete</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Settings -->
    <div class="section">
        <div class="section-header">
            <div>
                <h2 class="section-title">Notification Settings</h2>
                <p class="section-subtitle">Configure your notification preferences</p>
            </div>
        </div>

        <div class="settings-section">
            <h3 class="settings-title">Harvest Due Dates</h3>
            <div class="setting-item">
                <span class="setting-label">Weather Alerts</span>
                <div class="toggle active" onclick="toggleSetting(this)"></div>
            </div>
            <div class="setting-item">
                <span class="setting-label">Low Inventory</span>
                <div class="toggle active" onclick="toggleSetting(this)"></div>
            </div>
            <div class="setting-item">
                <span class="setting-label">Stock Expiry Warnings</span>
                <div class="toggle active" onclick="toggleSetting(this)"></div>
            </div>
            <div class="setting-item">
                <span class="setting-label">Task Completions</span>
                <div class="toggle" onclick="toggleSetting(this)"></div>
            </div>
            <div class="setting-item">
                <span class="setting-label">System Updates</span>
                <div class="toggle active" onclick="toggleSetting(this)"></div>
            </div>
        </div>

        <div class="settings-section">
            <h3 class="settings-title">Notification Channels</h3>
            <div class="setting-item">
                <span class="setting-label">Email Notifications</span>
                <div class="toggle active" onclick="toggleSetting(this)"></div>
            </div>
            <div class="setting-item">
                <span class="setting-label">SMS Alerts</span>
                <div class="toggle" onclick="toggleSetting(this)"></div>
            </div>
            <div class="setting-item">
                <span class="setting-label">Push Notifications</span>
                <div class="toggle active" onclick="toggleSetting(this)"></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Notification functions
    function markAsRead(button) {
        const notificationItem = button.closest('.notification-item');
        notificationItem.style.opacity = '0.6';
        button.textContent = 'Read';
        button.disabled = true;
        button.classList.add('btn-secondary');
        button.classList.remove('btn-primary');
        
        showToast('Notification marked as read', 'success');
    }

    function deleteNotification(button) {
        const notificationItem = button.closest('.notification-item');
        notificationItem.style.transform = 'translateX(100%)';
        notificationItem.style.opacity = '0';
        
        setTimeout(() => {
            notificationItem.remove();
            updateNotificationCounts();
            showToast('Notification deleted', 'success');
        }, 300);
    }

    function markAllRead() {
        const unreadNotifications = document.querySelectorAll('.notification-item button.btn-primary');
        unreadNotifications.forEach(button => {
            if (button.textContent === 'Mark Read') {
                markAsRead(button);
            }
        });
        showToast('All notifications marked as read', 'success');
    }

    function showUnread() {
        const allNotifications = document.querySelectorAll('.notification-item');
        allNotifications.forEach(item => {
            const markReadBtn = item.querySelector('button.btn-primary');
            if (markReadBtn && markReadBtn.textContent === 'Mark Read') {
                item.style.display = 'flex';
            } else {
                item.style.display = 'none';
            }
        });
        showToast('Showing unread notifications only', 'info');
    }

    function toggleSetting(toggleElement) {
        toggleElement.classList.toggle('active');
        const settingLabel = toggleElement.parentElement.querySelector('.setting-label').textContent;
        const isActive = toggleElement.classList.contains('active');
        
        showToast(`${settingLabel} ${isActive ? 'enabled' : 'disabled'}`, 'info');
    }

    function updateNotificationCounts() {
        const totalNotifications = document.querySelectorAll('.notification-item').length;
        const unreadNotifications = document.querySelectorAll('.notification-item button.btn-primary').length;
        const highPriorityNotifications = document.querySelectorAll('.priority-high').length;
        
        const statValues = document.querySelectorAll('.stat-value');
        if (statValues.length >= 4) {
            statValues[0].textContent = totalNotifications;
            statValues[1].textContent = unreadNotifications;
            statValues[2].textContent = highPriorityNotifications;
        }
    }

    function filterNotifications(type) {
        const allNotifications = document.querySelectorAll('.notification-item');
        allNotifications.forEach(item => {
            if (type === 'all' || item.dataset.type === type) {
                item.style.display = 'flex';
            } else {
                item.style.display = 'none';
            }
        });
    }

    function searchNotifications(query) {
        const allNotifications = document.querySelectorAll('.notification-item');
        const searchQuery = query.toLowerCase();
        
        allNotifications.forEach(item => {
            const title = item.querySelector('.notification-title').textContent.toLowerCase();
            const message = item.querySelector('.notification-message').textContent.toLowerCase();
            
            if (title.includes(searchQuery) || message.includes(searchQuery)) {
                item.style.display = 'flex';
            } else {
                item.style.display = 'none';
            }
        });
    }

    function autoRefreshNotifications() {
        console.log('Checking for new notifications...');
        
        if (Math.random() < 0.1) {
            showToast('New notification received', 'info');
            updateNotificationCounts();
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        updateNotificationCounts();
        
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'a':
                        e.preventDefault();
                        markAllRead();
                        break;
                    case 'u':
                        e.preventDefault();
                        showUnread();
                        break;
                }
            }
        });
    });

    setInterval(autoRefreshNotifications, 30000);
</script>
{% endblock %}